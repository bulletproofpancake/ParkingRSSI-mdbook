<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>DBHelper - ParkingRSSI Documentation</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../chapters/applicationOverview.html">Application Overview</a></li><li class="chapter-item expanded affix "><a href="../../chapters/algorithmOverview.html">Algorithm Overview</a></li><li class="chapter-item expanded affix "><a href="../../chapters/projectStructure.html">Project Structure</a></li><li class="spacer"></li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.</strong> Scripts</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapters/scripts/knn-classifier.html"><strong aria-hidden="true">1.1.</strong> KNN Classifier</a></li><li class="chapter-item expanded "><a href="../../chapters/scripts/main-activity.html"><strong aria-hidden="true">1.2.</strong> Main Activity</a></li><li class="chapter-item expanded "><a href="../../chapters/scripts/router.html"><strong aria-hidden="true">1.3.</strong> Router</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> Models</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapters/models/dbhelper.html" class="active"><strong aria-hidden="true">2.1.</strong> DBHelper</a></li><li class="chapter-item expanded "><a href="../../chapters/models/prefs.html"><strong aria-hidden="true">2.2.</strong> Prefs</a></li><li class="chapter-item expanded "><a href="../../chapters/models/rowdata.html"><strong aria-hidden="true">2.3.</strong> RowData</a></li><li class="chapter-item expanded "><a href="../../chapters/models/session.html"><strong aria-hidden="true">2.4.</strong> Session</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Views</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapters/views/homeFragment.html"><strong aria-hidden="true">3.1.</strong> Home Fragment</a></li><li class="chapter-item expanded "><a href="../../chapters/views/scanRouterFragment.html"><strong aria-hidden="true">3.2.</strong> Scan Router Fragment</a></li><li class="chapter-item expanded "><a href="../../chapters/views/sessionFragment.html"><strong aria-hidden="true">3.3.</strong> Session Fragment</a></li><li class="chapter-item expanded "><a href="../../chapters/views/dataFragment.html"><strong aria-hidden="true">3.4.</strong> Data Fragment</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">ParkingRSSI Documentation</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="dbhelper"><a class="header" href="#dbhelper">DBHelper</a></h1>
<p>The <code>DBHelper</code> class is responsible for <a href="https://developer.android.com/training/data-storage/sqlite">saving data in an SQLite database</a>.
The data is stored in an SQLite database so that it is easily accessible and scalable given the amount of data that is used by the application.</p>
<h2 id="snippet"><a class="header" href="#snippet">Snippet</a></h2>
<pre><code class="language-kt">class DBHelper(context: Context) :
  SQLiteOpenHelper(context, DATABASE_NAME, null, DATABASE_VERSION) {
  private val TAG = &quot;DB&quot;

  override fun onCreate(db: SQLiteDatabase) {
    db.execSQL(&quot;&quot;&quot;
      CREATE TABLE $SESSION_TABLE (
        $SESSION_ID     INTEGER      PRIMARY KEY AUTOINCREMENT,
        $SESSION_NAME   VARCHAR(100) NOT NULL,
        $SESSION_ROWS   INTEGER      NOT NULL,
        $SESSION_COLS   INTEGER      NOT NULL
      );
    &quot;&quot;&quot;.trimIndent())

    db.execSQL(&quot;&quot;&quot;
      CREATE TABLE $ROUTER_TABLE (
        $ROUTER_BSSID   INTEGER     PRIMARY KEY,
        $ROUTER_NAME  VARCHAR(100)  NOT NULL
      );
    &quot;&quot;&quot;.trimIndent())

    db.execSQL(&quot;&quot;&quot;
      CREATE TABLE $SESSION_ROUTER_TABLE (
        $SESSION_ROUTER_ID          INTEGER PRIMARY KEY AUTOINCREMENT,
        $SESSION_ROUTER_SESSION_ID  INTEGER NOT NULL,
        $SESSION_ROUTER_ROUTER_ID   INTEGER NOT NULL,
        $SESSION_ROUTER_ROW         INTEGER NOT NULL,
        $SESSION_ROUTER_COL         INTEGER NOT NULL,
        FOREIGN KEY($SESSION_ROUTER_SESSION_ID) REFERENCES $SESSION_TABLE($SESSION_ID) ON DELETE CASCADE,
        FOREIGN KEY($SESSION_ROUTER_ROUTER_ID) REFERENCES $ROUTER_TABLE($ROUTER_BSSID),
        UNIQUE($SESSION_ROUTER_SESSION_ID, $SESSION_ROUTER_ROUTER_ID)
      );
    &quot;&quot;&quot;.trimIndent())

    db.execSQL(&quot;&quot;&quot;
      CREATE TABLE $RECORD_TABLE (
        $RECORD_ID          INTEGER   PRIMARY KEY AUTOINCREMENT,
        $RECORD_SESSION_ID  INTEGER   NOT NULL,
        $RECORD_LABEL       INTEGER   NOT NULL,
        $RECORD_TIMESTAMP   TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
        FOREIGN KEY($RECORD_SESSION_ID) REFERENCES $SESSION_TABLE($SESSION_ID) ON DELETE CASCADE
      );
    &quot;&quot;&quot;.trimIndent())

    db.execSQL(&quot;&quot;&quot;
      CREATE TABLE $DATA_TABLE (
        $DATA_ID          INTEGER PRIMARY KEY AUTOINCREMENT,
        $DATA_RECORD_ID   INTEGER NOT NULL,
        $DATA_ROUTER_ID   INTEGER NOT NULL,
        $DATA_VALUE       INTEGER NOT NULL,
        FOREIGN KEY($DATA_RECORD_ID) REFERENCES $RECORD_ID($RECORD_ID) ON DELETE CASCADE,
        FOREIGN KEY($DATA_ROUTER_ID) REFERENCES $ROUTER_TABLE($ROUTER_BSSID)
      )
    &quot;&quot;&quot;.trimIndent())
  }

  override fun onUpgrade(db: SQLiteDatabase?, oldVersion: Int, newVersion: Int) {
    if (db == null) return;
    db.execSQL(&quot;DROP TABLE IF EXISTS $DATA_TABLE&quot;)
    db.execSQL(&quot;DROP TABLE IF EXISTS $RECORD_TABLE&quot;)
    db.execSQL(&quot;DROP TABLE IF EXISTS $SESSION_ROUTER_TABLE&quot;)
    db.execSQL(&quot;DROP TABLE IF EXISTS $ROUTER_TABLE&quot;)
    db.execSQL(&quot;DROP TABLE IF EXISTS $SESSION_TABLE&quot;)
    onCreate(db)
  }

  // Session
  fun addSession(name: String, rows: Int, cols: Int): Long {
    val values = ContentValues()
    values.put(SESSION_NAME, name)
    values.put(SESSION_ROWS, rows)
    values.put(SESSION_COLS, cols)

    val db = this.writableDatabase
    return try {
      db.insertOrThrow(SESSION_TABLE, null, values)
    } catch (e: Exception) {
      Log.e(TAG, Log.getStackTraceString(e))
      -1L
    }
  }

  fun updateSession(session: Session) {
    val values = ContentValues()
    values.put(SESSION_NAME, session.name)
    values.put(SESSION_ROWS, session.rows)
    values.put(SESSION_COLS, session.cols)

    val db = this.writableDatabase
    db.update(SESSION_TABLE, values,
      &quot;$SESSION_ID=?&quot;, arrayOf(session.id.toString()))
  }

  fun getSessionById(id: Long): Session? {
    val db = this.readableDatabase
    val query = &quot;&quot;&quot;
      SELECT  *
      FROM    $SESSION_TABLE
      WHERE   $SESSION_ID=?
      LIMIT   1;
    &quot;&quot;&quot;.trimIndent()
    val cursor = db.rawQuery(query, arrayOf(id.toString()))
    if (!cursor.moveToFirst()) {
      return null
    }

    return Session(
      cursor.getLong(cursor.getColumnIndex(SESSION_ID)),
      cursor.getString(cursor.getColumnIndex(SESSION_NAME)),
      cursor.getInt(cursor.getColumnIndex(SESSION_ROWS)),
      cursor.getInt(cursor.getColumnIndex(SESSION_COLS))
    )
  }
  
  @SuppressLint(&quot;Recycle&quot;)
  fun getAllSessions(): ArrayList&lt;Session&gt; {
    val db = this.readableDatabase
    val query = &quot;&quot;&quot;
      SELECT  *
      FROM    $SESSION_TABLE;
    &quot;&quot;&quot;.trimIndent()
    val cursor = db.rawQuery(query, null)
    if (!cursor.moveToFirst()) {
      return arrayListOf()
    }

    val idIndex = cursor.getColumnIndex(&quot;id&quot;)
    val nameIndex = cursor.getColumnIndex(&quot;name&quot;)
    val rowsIndex = cursor.getColumnIndex(&quot;rows&quot;)
    val colsIndex = cursor.getColumnIndex(&quot;cols&quot;)
    val sessions = arrayListOf&lt;Session&gt;()
    do {
      sessions.add(Session(
        cursor.getLong(idIndex),
        cursor.getString(nameIndex),
        cursor.getInt(rowsIndex),
        cursor.getInt(colsIndex)
      ))
    } while (cursor.moveToNext())

    return sessions
  }

  fun deleteSession(id: Long) {
    val db = this.writableDatabase
    db.delete(SESSION_TABLE, &quot;id=?&quot;, arrayOf(id.toString()))
  }

  // Router Db CRUD
  fun addRouter(bssid: Long, name: String) {
    val values = ContentValues()
    values.put(ROUTER_BSSID, bssid)
    values.put(ROUTER_NAME, name)

    val db = this.writableDatabase
    db.insertWithOnConflict(
      ROUTER_TABLE, null,
      values, SQLiteDatabase.CONFLICT_IGNORE
    )
  }

  /**
   * Gets all the routers added
   *
   * @return Map of (bssid: router name)
   */
  @SuppressLint(&quot;Recycle&quot;)
  fun getRouters(): ArrayList&lt;Router&gt; {
    val db = this.readableDatabase
    val query = &quot;&quot;&quot;
      SELECT  *
      FROM  $ROUTER_TABLE;
    &quot;&quot;&quot;.trimIndent()
    val cursor = db.rawQuery(query, null)
    if (!cursor!!.moveToFirst()) {
      return arrayListOf()
    }

    val routers = arrayListOf&lt;Router&gt;()
    do {
      routers.add(Router(
        cursor.getLong(cursor.getColumnIndex(ROUTER_BSSID)),
        cursor.getString(cursor.getColumnIndex(ROUTER_NAME))
      ))
    } while (cursor.moveToNext())

    return routers
  }

  // Session Router Db CRUD
  /**
   * Adds a new session router row
   *
   * @param sessionId Session Id
   * @param bssid Router Id
   * @param row Row of the router in the matrix
   * @param col Col of the router in the matrix
   */
  fun addSessionRouter(sessionId: Long, bssid: Long, row: Int, col: Int) {
    val values = ContentValues()
    values.put(SESSION_ROUTER_SESSION_ID, sessionId)
    values.put(SESSION_ROUTER_ROUTER_ID, bssid)
    values.put(SESSION_ROUTER_ROW, row)
    values.put(SESSION_ROUTER_COL, col)

    val db = this.writableDatabase
    db.insert(SESSION_ROUTER_TABLE, null, values)
  }

  fun deleteSessionRouters(sessionId: Long) {
    val db = this.writableDatabase
    db.delete(SESSION_ROUTER_TABLE, &quot;$SESSION_ROUTER_SESSION_ID=?&quot;, arrayOf(sessionId.toString()))
  }

  /**
   *
   */
  @SuppressLint(&quot;Recycle&quot;)
  fun getSessionRouters(sessionId: Long): ArrayList&lt;Router&gt; {
    val db = this.readableDatabase
    val query = &quot;&quot;&quot;
      SELECT
        r.$ROUTER_BSSID AS id,
        r.$ROUTER_NAME AS name,
        sr.$SESSION_ROUTER_ROW AS `row`,
        sr.$SESSION_ROUTER_COL AS col
      FROM (
        SELECT    *
        FROM      $SESSION_ROUTER_TABLE
        WHERE     $SESSION_ROUTER_SESSION_ID=?
      ) AS sr
      JOIN        $ROUTER_TABLE r
        ON        r.$ROUTER_BSSID = sr.$SESSION_ROUTER_ROUTER_ID
      ORDER BY    sr.$SESSION_ROUTER_ROW, sr.$SESSION_ROUTER_COL;
    &quot;&quot;&quot;.trimIndent()
    val cursor = db.rawQuery(query, arrayOf(sessionId.toString()))
    if (!cursor!!.moveToFirst()) {
      return arrayListOf()
    }

    val bssidIndex = cursor.getColumnIndex(&quot;id&quot;)
    val nameIndex = cursor.getColumnIndex(&quot;name&quot;)
    val rowIndex = cursor.getColumnIndex(&quot;row&quot;)
    val colIndex = cursor.getColumnIndex(&quot;col&quot;)

    val routers = arrayListOf&lt;Router&gt;()
    do {
      val router = Router(
        cursor.getLong(bssidIndex),
        cursor.getString(nameIndex)
      )
      router.row = cursor.getInt(rowIndex)
      router.col = cursor.getInt(colIndex)
      routers.add(router)
    } while (cursor.moveToNext())

    return routers
  }

  // Record and Data
  /**
   * Adds a row of data to a session
   *
   * @param label
   * @param values Key Value pair of router bssid and value
   */
  fun addRow(sessionId: Long, label: Int, values: HashMap&lt;Long, Float&gt;) {
    val db = this.writableDatabase
    db.transaction {
      // Create a record
      val contentValues = ContentValues()
      contentValues.put(RECORD_SESSION_ID, sessionId)
      contentValues.put(RECORD_LABEL, label)

      val id: Long = this.insert(RECORD_TABLE, null, contentValues)

      for ((bssid, value) in values) {
        Log.d(TAG, &quot;INSERTING: $bssid: $value&quot;)
        contentValues.clear()
        contentValues.put(DATA_RECORD_ID, id)
        contentValues.put(DATA_ROUTER_ID, bssid)
        contentValues.put(DATA_VALUE, value)
        this.insert(DATA_TABLE, null, contentValues)
      }
    }
  }

  /**
   * Updates a row of data
   *
   * @param sessionId To get the current routers
   * @param recordId Record id
   * @param values Array of new dbm values
   */
  fun updateRow(sessionId: Long, recordId: Long, values: ArrayList&lt;Float&gt;): Boolean {
    // Get the ordered session routers
    val routers = getSessionRouters(sessionId)

    if (routers.size != values.size) {
      Log.e(TAG, &quot;Size not matching ${routers.size} ${values.size}&quot;)
      return false
    }

    val db = this.writableDatabase
    try {
      db.transaction {
        val contentValues = ContentValues()
        for (i in 0 until routers.size) {
          contentValues.clear()
          contentValues.put(DATA_VALUE, values[i])

          val wheres = arrayOf(recordId.toString(), routers[i].getBSSID().toString())
          this.update(DATA_TABLE, contentValues,
            &quot;$DATA_RECORD_ID=? AND $DATA_ROUTER_ID=?&quot;,
            wheres
          )
        }
      }
    } catch (e: Exception) {
      Log.e(TAG, Log.getStackTraceString(e))
      return false
    }

    return true
  }

  /**
   * Deletes a row of data
   *
   * @param recordId The record table
   */
  fun deleteRow(recordId: Long) {
    val db = this.writableDatabase
    db.delete(RECORD_TABLE, &quot;$RECORD_ID=?&quot;, arrayOf(recordId.toString()))
  }

  /**
   * Deletes all rows from a session
   *
   * @param sessionId
   */
  fun deleteSessionRows(sessionId: Long) {
    val db = this.writableDatabase
    db.delete(RECORD_TABLE, &quot;$RECORD_SESSION_ID=?&quot;, arrayOf(sessionId.toString()))
  }

  /**
   * Returns the whole data set of labels and values
   *
   * @param sessionId Session
   * @return
   */
  @SuppressLint(&quot;Recycle&quot;)
  fun getData(sessionId: Long): ArrayList&lt;RowData&gt; {
    val db = this.readableDatabase

    val session = getSessionById(sessionId) ?: return arrayListOf()
    val size = session.rows * session.cols

    // Get all rows
    val rowCursor = db.rawQuery(&quot;&quot;&quot;
      SELECT    $RECORD_ID, $RECORD_LABEL
      FROM      $RECORD_TABLE
      WHERE     $RECORD_SESSION_ID=?
      ORDER BY  $RECORD_TIMESTAMP;
    &quot;&quot;&quot;.trimIndent(), arrayOf(sessionId.toString()))

    if (!rowCursor.moveToFirst()) {
      Log.e(TAG, &quot;No rows found&quot;)
      rowCursor.close()
      return arrayListOf()
    }

    // Query per row
    val idIndex = rowCursor.getColumnIndex(RECORD_ID)
    val labelIndex = rowCursor.getColumnIndex(RECORD_LABEL)
    val data = arrayListOf&lt;RowData&gt;()
    do {
      val rowData = RowData(rowCursor.getLong(idIndex), rowCursor.getInt(labelIndex))

      val colCursor = db.rawQuery(&quot;&quot;&quot;
        SELECT  sr.$SESSION_ROUTER_ROUTER_ID, d.$DATA_VALUE
        FROM (
          SELECT  *
          FROM    $DATA_TABLE
          WHERE   $DATA_RECORD_ID=?
          LIMIT   ?
        ) AS d
        LEFT JOIN ( -- TODO: Can be placed in a temporary table
          SELECT  *
          FROM    $SESSION_ROUTER_TABLE
          WHERE   $SESSION_ROUTER_SESSION_ID=?
          LIMIT   ?
        ) AS sr
          ON        sr.$SESSION_ROUTER_ROUTER_ID = d.$DATA_ROUTER_ID
        ORDER BY    sr.$SESSION_ROUTER_ROW, sr.$SESSION_ROUTER_COL;
      &quot;&quot;&quot;.trimIndent(), arrayOf(
        rowCursor.getString(idIndex), size.toString(),
        sessionId.toString(), size.toString()
      ))

      if (!colCursor.moveToFirst()) {
        Log.e(TAG, &quot;No cols were found&quot;)
        colCursor.close()
        rowCursor.close()
        return arrayListOf() // ERROR
      }

      val valIndex = colCursor.getColumnIndex(DATA_VALUE)
      do {
        rowData.addVal(colCursor.getFloat(valIndex))
      } while (colCursor.moveToNext())
      colCursor.close()

      if (rowData.values.size != size) {
        Log.e(TAG, &quot;Size does not match, ${rowData.values.size} != $size&quot;)
        rowCursor.close()
        return arrayListOf() // ERROR
      }

      data.add(rowData)
    } while (rowCursor.moveToNext())
    rowCursor.close()

    return data
  }

  companion object {
    // Singleton
    private var sInstance: DBHelper? = null
    @Synchronized
    fun getInstance(ctx: Context): DBHelper? {
      if (sInstance == null) {
        sInstance = DBHelper(ctx.applicationContext)
      }
      return sInstance
    }

    private const val DATABASE_NAME = &quot;parking_rssi&quot;
    private const val DATABASE_VERSION = 13

    // SESSIONS
    const val SESSION_TABLE = &quot;sessions&quot;
    const val SESSION_ID = &quot;id&quot;
    const val SESSION_NAME = &quot;name&quot;
    const val SESSION_ROWS = &quot;rows&quot;
    const val SESSION_COLS = &quot;cols&quot;

    // ROUTERS
    const val ROUTER_TABLE = &quot;routers&quot;
    const val ROUTER_BSSID = &quot;bssid&quot;
    const val ROUTER_NAME = &quot;name&quot;

    // SESSION_ROUTERS
    const val SESSION_ROUTER_TABLE = &quot;session_routers&quot;
    const val SESSION_ROUTER_ID = &quot;id&quot;
    const val SESSION_ROUTER_SESSION_ID = &quot;session_id&quot;
    const val SESSION_ROUTER_ROUTER_ID = &quot;router_id&quot;
    const val SESSION_ROUTER_ROW = &quot;r&quot;
    const val SESSION_ROUTER_COL = &quot;c&quot;

    // RECORDS
    const val RECORD_TABLE = &quot;records&quot;
    const val RECORD_ID = &quot;id&quot;
    const val RECORD_SESSION_ID = &quot;session_id&quot;
    const val RECORD_LABEL = &quot;label&quot;
    const val RECORD_TIMESTAMP = &quot;timestamp&quot;

    // DATA
    const val DATA_TABLE = &quot;data&quot;
    const val DATA_ID = &quot;id&quot;
    const val DATA_RECORD_ID = &quot;record_id&quot;
    const val DATA_ROUTER_ID = &quot;router_id&quot;
    const val DATA_VALUE = &quot;value&quot;
  }
}

</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../chapters/scripts/router.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../../chapters/models/prefs.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../chapters/scripts/router.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../../chapters/models/prefs.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
